[gcode_macro SET_LED_LENGTH]
description: SET_LED_LENGTH LED=<config_name> RED=<value> GREEN=<value> BLUE=<value> WHITE=<value> INDEX=<indexToStart> COUNT=<numberOfPixels>
gcode: 
    {% set ledName= params.LED|default(0)|string %}
    {% set colorRed= params.RED|default(0)|float %}
    {% set colorGreen= params.GREEN|default(0)|float %}
    {% set colorBlue= params.BLUE|default(0)|float %}
    {% set colorWhite= params.WHITE|default(0)|float %}
    {% set indexCount= params.INDEX|default(0)|int %}
    {% set pixelCount= params.COUNT|default(0)|int %}
    
    {% for index in range(indexCount,indexCount + pixelCount) %}
        SET_LED LED={ledName} RED={colorRed} GREEN={colorGreen} BLUE={colorBlue} WHITE={colorWhite} INDEX={index} TRANSMIT={ '1' if index==(indexCount+pixelCount-1) else '0' }
    {% endfor %}

[gcode_macro _SET_CASE_LEDS]
description: Helper: Set the color for a segment of the case led strip.
gcode:
    {% set r = params.R|default(0)|float %}
    {% set g = params.G|default(0)|float %}
    {% set b = params.B|default(0)|float %}
    {% set w = params.W|default(0)|float %}
    {% set idx = params.IDX|default(1)|int %}
    {% set cnt = params.CNT|default(27)|int %}

    SET_LED_LENGTH LED=case_leds RED={r} GREEN={g} BLUE={b} WHITE={w} INDEX={idx} COUNT={cnt}

[gcode_macro _CASELIGHT_ON]
description: Helper: Light on
gcode:
  _SET_CASE_LEDS R=0.5 G=0.5 B=0.5 W=0.5

[gcode_macro _CASELIGHT_OFF]
description: Helper: Light off
gcode:
  _SET_CASE_LEDS  R=0 G=0 B=0 W=0

[gcode_macro CASELIGHT]
description: Toggle case light
gcode:
    {% set current_brightness = printer["neopixel case_leds"].color_data[0][3]|default(0)|float %}
    {% if current_brightness > 0.0 %}
        _CASELIGHT_OFF
    {% else %}
        _CASELIGHT_ON
    {% endif %}